<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mysql on 逆天改命</title><link>https://linkall.pub/tags/mysql/</link><description>Recent content in mysql on 逆天改命</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 02 Jun 2020 11:09:54 +0000</lastBuildDate><atom:link href="https://linkall.pub/tags/mysql/index.xml" rel="self" type="application/rss+xml"/><item><title>Mysql5.7主从复制</title><link>https://linkall.pub/blog/mysql-master-slave/</link><pubDate>Tue, 02 Jun 2020 11:09:54 +0000</pubDate><guid>https://linkall.pub/blog/mysql-master-slave/</guid><description>环境 Linux:CentOS7 Mysql:5.7 服务器:腾讯云
安装 见：https://blog.csdn.net/haxyek/article/details/85273553 安装后可能需要的初始化命令：
mysqld --initialize-insecure --user=mysql --explicit_defaults_for_timestamp 主从复制原理 从服务器读取主服务器的binlog，进行数据复制。
主从复制实践 主服务器配置： 第一步：修改my.cnf文件 [mysqld]段增加
#启动而进制日志 log-bin=mysql-bin #服务器唯一ID，一般取IP最后一段 server-id=83 第二步：重启mysql服务 systemctl restart mysqld 第三步：主机给从机授权备份权限 登录到主机的mysql
myysql&amp;gt; GRANT REPLication slave on *.* to &amp;#39;从机用户名&amp;#39;@&amp;#39;从机ip地址&amp;#39; identified by &amp;#39;从机密码&amp;#39;; 示例
myysql&amp;gt; GRANT REPLication slave on *.* to &amp;#39;slave&amp;#39;@&amp;#39;172.32.1.16&amp;#39; identified by &amp;#39;slave_password&amp;#39;; 第四步：刷新权限 mysql&amp;gt;flush privileges; 第五步：查询master的状态 mysql&amp;gt;show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.</description></item><item><title>Mysql 数据库名、表名大小写</title><link>https://linkall.pub/blog/mysql-dbname-tablename/</link><pubDate>Tue, 02 Jun 2020 01:44:03 +0000</pubDate><guid>https://linkall.pub/blog/mysql-dbname-tablename/</guid><description>[mysqld] lower-case-table-names=0 ** windows默认为0，unix默认为1； **
变量lower-case-table-names的取值 取值范围有三个，分别是0、1、2.
设置成0：表名按你写的SQL大小写存储，大写就大写小写就小写，比较时大小写敏感。 设置成1：表名转小写后存储到硬盘，比较时大小写不敏感。 设置成2：表名按你写的SQL大小写存储，大写就大写小写就小写，比较时统一转小写比较。 这个选项不仅仅适用于表名的大小写敏感，同样适用于数据库名和表别名。</description></item><item><title>mysql bin-log 误操作数据修复</title><link>https://linkall.pub/blog/mysql-bin-log-reverse/</link><pubDate>Mon, 01 Jun 2020 18:25:23 +0000</pubDate><guid>https://linkall.pub/blog/mysql-bin-log-reverse/</guid><description>先说原理 基于全量备份，加bin-log，将数据恢复到误操作之前节点数据，然后跳过误操作，执行后面操作。使用binlog文件转成sql执行，导入到数据库。
查看binlog文件 如果有多个binlog日志也可以在Mysql命令行下查看当前binlog、切割binlog日志。切割完成binlog再次查看就会看到新的日志写入到新的binlog文件中。
mysql&amp;gt; show master status; +------------------+-----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+-----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 343629748 | | | | +------------------+-----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) mysql&amp;gt; flush logs; Query OK, 0 rows affected (0.01 sec) 找到binlog中错误的语句 使用mysqlbinlog命令加参数，可以指定时间段，和pos节点：
--start-position 起始点 --stop-position 结束点（不包含） --start-datetime=“2017--11-01 00:00:00” 起始时间 --stop-datetime=&amp;#34;2017-11-11 00:00:00&amp;#34; 终止时间 -d db_name 指定数据库 -v 是显示出一些sql的信息 -vv 则是多一些注释性的东西 --base64-output=DECODE-ROWS 这个是把sql解码出来 可以binlog日志中找到错误语句执行的时间点，分别恢复错误语句前后的binlog日志为sql。也可以跳过此步，直接恢复整个binlog日志为sql，然后打开sql文件，删除错误语句。
可以根据时间点来确定误操作的确切时间 mysqlbinlog --no-defaults --database=order --start-datetime=&amp;#39;2019-11-02 3:08&amp;#39; --stop-datetime=&amp;#39;2019-11-02 23:08&amp;#39; --base64-output=DECODE-ROWS mysql-bin.</description></item><item><title>MySQL初始化基础配置</title><link>https://linkall.pub/blog/mysql-base-config/</link><pubDate>Mon, 01 Jun 2020 05:44:28 +0000</pubDate><guid>https://linkall.pub/blog/mysql-base-config/</guid><description>CentOS7安装Mysql5.7 https://75051685.xyz/archives/centos7-install-mysql
修改编码：/etc/my.cnf
[client] default-character-set = utf8 [mysqld] default-storage-engine = INNODB character-set-server = utf8 collation-server = utf8_general_ci # 不区分大小写 collation-server = utf8_bin # 区分大小写 collation-server = utf8_unicode_ci # 比 utf8_general_ci 更准确 lower_case_table_names=2 # 表名区分大小写 max_connections=1000 # 最大连接数 创建数据库和用户 # 创建数据库，编码utf8 CREATE DATABASE &amp;lt;datebasename&amp;gt; CHARACTER SET utf8; # 创建用户，指定用户名，密码，访问主机 CREATE USER &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39; IDENTIFIED BY &amp;#39;password&amp;#39;; # 设置权限 GRANT privileges ON databasename.tablename TO &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39;; # 显示权限 SHOW GRANTS FOR &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39;; # 回收用户权限 REVOKE privilege ON databasename.</description></item><item><title>一步一步CentOS7 安装 MySQL5.7</title><link>https://linkall.pub/blog/centos7-install-mysql/</link><pubDate>Mon, 01 Jun 2020 01:40:01 +0000</pubDate><guid>https://linkall.pub/blog/centos7-install-mysql/</guid><description>说明： 此文章用于安装Oracle Mysql，而非MariaDB。
yum源处理 对于yum安装，需要知道yum源，参考官网信息即可：
https://dev.mysql.com/downloads/repo/yum/
同时贴出apt源：
https://dev.mysql.com/downloads/repo/apt/
选择下载，本文贴出两个地址一个是5.7，一个是8.0：
# 5.7 https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm # 8.0 最新版本（2018-12-27） https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm 根据两个地址的对比，其他版本链接请自行揣测。下载完后进行安装：
# 安装rpm包 sudo rpm -Uvh mysql57-community-release-el7-11.noarch.rpm # 查看yum yum repolist all | grep mysql # 显示结果 mysql-connectors-community/x86_64 MySQL Connectors Community mysql-tools-community/x86_64 MySQL Tools Community mysql57-community/x86_64 MySQL 5.7 Community Server 安装 sudo yum install mysql-community-server 启动 MySQL 服务 Mysql5.7版本默认设置了临时密码，需要在启动之后查看运行日志，里面会有临时密码显示：
sudo cat /var/log/mysqld.log | grep &amp;#39;temporary password&amp;#39; 修改密码 $ mysql -uroot -p #输入查看到的密码 # 新密码要求符合密码规范。大小写，特殊字符数字等。 mysql&amp;gt; ALTER USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;!</description></item><item><title>使用general_log来对Mysql SQL语句监控查看的记录</title><link>https://linkall.pub/blog/mysql-sql-monitor/</link><pubDate>Sun, 31 May 2020 18:27:22 +0000</pubDate><guid>https://linkall.pub/blog/mysql-sql-monitor/</guid><description>查看日志位置：
show global variables like '%general%'; +——————+———-+ |Variable_name|Value| +——————+———-+ |general_log|OFF| |general_log_file|/data0/logs/mysql/general.log| +——————+———-+ 设置 SET GLOBAL general_log = 'ON';
使用tail -f 日志位置 查看即时日志。
临时开启日志记录
set global general_log='ON'; 这时执行的所有sql都会被记录下来，但是如果重启mysql就会停止记录需要重新设置
查看日志
tail -f /data0/logs/mysql/general.log 查看全部
cat /data0/logs/mysql/general.log 查看是否开启binlog
show variables like “log_bin” ; 查看当前的binlog日志
show master status ;</description></item><item><title>使用mysqldump导出mysql表结构和表数据</title><link>https://linkall.pub/blog/mysql-dump-usage/</link><pubDate>Mon, 25 May 2020 18:19:28 +0000</pubDate><guid>https://linkall.pub/blog/mysql-dump-usage/</guid><description>创建备份用户 create user dumper@&amp;#39;127.0.0.1&amp;#39; identified by &amp;#39;12345678&amp;#39;; 赋权限 grant select on *.* to dumper@&amp;#39;127.0.0.1&amp;#39;; grant lock tables on *.* to dumper@&amp;#39;127.0.0.1&amp;#39;; 备份脚本 #!/bin/bash mkdir /tmp/`date +%y%m%d` mysqldump -h127.0.0.1 -u dumper -p12345678 dbname &amp;gt; /tmp/`date +%y%m%d`/db.sql crontab定时任务 凌晨三点执行脚本。
0 3 * * * /opt/software/backup_db.sh &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 MySQL 备份包含 emoji 表情的数据 在执行备份命令时，指定字符集即可（@see mysqldump &amp;ndash;help）
$ mysqldump -uroot -p123456 --default-character-set=utf8mb4 db_name &amp;gt; db_name_bak.sql 常见用法 命令行下具体用法如下：
mysqldump -u用戶名 -p密码 -d 数据库名 表名 &amp;gt; 脚本名; 导出整个数据库结构和数据</description></item><item><title>MySQL查看数据库表容量大小</title><link>https://linkall.pub/blog/mysql-view-database-table-capacity/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://linkall.pub/blog/mysql-view-database-table-capacity/</guid><description>1.查看所有数据库容量大小 select table_schema as &amp;#39;数据库&amp;#39;, sum(table_rows) as &amp;#39;记录数&amp;#39;, sum(truncate(data_length / 1024 / 1024, 2)) as &amp;#39;数据容量(MB)&amp;#39;, sum(truncate(index_length / 1024 / 1024, 2)) as &amp;#39;索引容量(MB)&amp;#39; from information_schema.tables group by table_schema order by sum(data_length) desc, sum(index_length) desc; 2.查看所有数据库各表容量大小 select table_schema as &amp;#39;数据库&amp;#39;, table_name as &amp;#39;表名&amp;#39;, table_rows as &amp;#39;记录数&amp;#39;, truncate(data_length / 1024 / 1024, 2) as &amp;#39;数据容量(MB)&amp;#39;, truncate(index_length / 1024 / 1024, 2) as &amp;#39;索引容量(MB)&amp;#39; from information_schema.tables order by data_length desc, index_length desc; 3.</description></item></channel></rss>