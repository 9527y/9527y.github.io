<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>mysql | 逆天改命</title><meta name=google-adsense-account content="ca-pub-7732072032123305"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=keywords content><meta name=description content><meta name=generator content="Hugo 0.119.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link href=/tags/mysql/index.xml rel=alternate type=application/rss+xml title=逆天改命><link href=/tags/mysql/index.xml rel=feed type=application/rss+xml title=逆天改命><link rel=canonical href=https://linkall.pub/tags/mysql/><meta property="og:title" content="mysql"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://linkall.pub/tags/mysql/"><meta itemprop=name content="mysql"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="mysql"><meta name=twitter:description content></head><body class="ma0 avenir bg-near-white"><header><div class="pb3-m pb6-l bg-black"><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">逆天改命</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav><div class="tc-l pv3 ph3 ph4-ns"><h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">mysql</h1></div></div></header><main class=pb7 role=main><article class="cf pa3 pa4-m pa4-l"><div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links mid-gray"><p>Below you will find pages that utilize the taxonomy term “mysql”</p></div></article><div class="mw8 center"><section class="flex-ns flex-wrap justify-around mt5"><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-master-slave/ class="link black dim">Mysql5.7主从复制</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">环境 Linux:CentOS7 Mysql:5.7 服务器:腾讯云
安装 见：https://blog.csdn.net/haxyek/article/details/85273553 安装后可能需要的初始化命令：
mysqld --initialize-insecure --user=mysql --explicit_defaults_for_timestamp 主从复制原理 从服务器读取主服务器的binlog，进行数据复制。
主从复制实践 主服务器配置： 第一步：修改my.cnf文件 [mysqld]段增加
#启动而进制日志 log-bin=mysql-bin #服务器唯一ID，一般取IP最后一段 server-id=83 第二步：重启mysql服务 systemctl restart mysqld 第三步：主机给从机授权备份权限 登录到主机的mysql
myysql> GRANT REPLication slave on *.* to '从机用户名'@'从机ip地址' identified by '从机密码'; 示例
myysql> GRANT REPLication slave on *.* to 'slave'@'172.32.1.16' identified by 'slave_password'; 第四步：刷新权限 mysql>flush privileges; 第五步：查询master的状态 mysql>show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.</div><a href=/blog/mysql-master-slave/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-dbname-tablename/ class="link black dim">Mysql 数据库名、表名大小写</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">[mysqld] lower-case-table-names=0 ** windows默认为0，unix默认为1； **
变量lower-case-table-names的取值 取值范围有三个，分别是0、1、2.
设置成0：表名按你写的SQL大小写存储，大写就大写小写就小写，比较时大小写敏感。 设置成1：表名转小写后存储到硬盘，比较时大小写不敏感。 设置成2：表名按你写的SQL大小写存储，大写就大写小写就小写，比较时统一转小写比较。 这个选项不仅仅适用于表名的大小写敏感，同样适用于数据库名和表别名。</div><a href=/blog/mysql-dbname-tablename/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-bin-log-reverse/ class="link black dim">mysql bin-log 误操作数据修复</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">先说原理 基于全量备份，加bin-log，将数据恢复到误操作之前节点数据，然后跳过误操作，执行后面操作。使用binlog文件转成sql执行，导入到数据库。
查看binlog文件 如果有多个binlog日志也可以在Mysql命令行下查看当前binlog、切割binlog日志。切割完成binlog再次查看就会看到新的日志写入到新的binlog文件中。
mysql> show master status; +------------------+-----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+-----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 343629748 | | | | +------------------+-----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) mysql> flush logs; Query OK, 0 rows affected (0.01 sec) 找到binlog中错误的语句 使用mysqlbinlog命令加参数，可以指定时间段，和pos节点：
--start-position 起始点 --stop-position 结束点（不包含） --start-datetime=“2017--11-01 00:00:00” 起始时间 --stop-datetime="2017-11-11 00:00:00" 终止时间 -d db_name 指定数据库 -v 是显示出一些sql的信息 -vv 则是多一些注释性的东西 --base64-output=DECODE-ROWS 这个是把sql解码出来 可以binlog日志中找到错误语句执行的时间点，分别恢复错误语句前后的binlog日志为sql。也可以跳过此步，直接恢复整个binlog日志为sql，然后打开sql文件，删除错误语句。
可以根据时间点来确定误操作的确切时间 mysqlbinlog --no-defaults --database=order --start-datetime='2019-11-02 3:08' --stop-datetime='2019-11-02 23:08' --base64-output=DECODE-ROWS mysql-bin.</div><a href=/blog/mysql-bin-log-reverse/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-base-config/ class="link black dim">MySQL初始化基础配置</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">CentOS7安装Mysql5.7 https://75051685.xyz/archives/centos7-install-mysql
修改编码：/etc/my.cnf
[client] default-character-set = utf8 [mysqld] default-storage-engine = INNODB character-set-server = utf8 collation-server = utf8_general_ci # 不区分大小写 collation-server = utf8_bin # 区分大小写 collation-server = utf8_unicode_ci # 比 utf8_general_ci 更准确 lower_case_table_names=2 # 表名区分大小写 max_connections=1000 # 最大连接数 创建数据库和用户 # 创建数据库，编码utf8 CREATE DATABASE &lt;datebasename> CHARACTER SET utf8; # 创建用户，指定用户名，密码，访问主机 CREATE USER 'username'@'host' IDENTIFIED BY 'password'; # 设置权限 GRANT privileges ON databasename.tablename TO 'username'@'host'; # 显示权限 SHOW GRANTS FOR 'username'@'host'; # 回收用户权限 REVOKE privilege ON databasename.</div><a href=/blog/mysql-base-config/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/centos7-install-mysql/ class="link black dim">一步一步CentOS7 安装 MySQL5.7</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">说明： 此文章用于安装Oracle Mysql，而非MariaDB。
yum源处理 对于yum安装，需要知道yum源，参考官网信息即可：
https://dev.mysql.com/downloads/repo/yum/
同时贴出apt源：
https://dev.mysql.com/downloads/repo/apt/
选择下载，本文贴出两个地址一个是5.7，一个是8.0：
# 5.7 https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm # 8.0 最新版本（2018-12-27） https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm 根据两个地址的对比，其他版本链接请自行揣测。下载完后进行安装：
# 安装rpm包 sudo rpm -Uvh mysql57-community-release-el7-11.noarch.rpm # 查看yum yum repolist all | grep mysql # 显示结果 mysql-connectors-community/x86_64 MySQL Connectors Community mysql-tools-community/x86_64 MySQL Tools Community mysql57-community/x86_64 MySQL 5.7 Community Server 安装 sudo yum install mysql-community-server 启动 MySQL 服务 Mysql5.7版本默认设置了临时密码，需要在启动之后查看运行日志，里面会有临时密码显示：
sudo cat /var/log/mysqld.log | grep 'temporary password' 修改密码 $ mysql -uroot -p #输入查看到的密码 # 新密码要求符合密码规范。大小写，特殊字符数字等。 mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY '!</div><a href=/blog/centos7-install-mysql/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-sql-monitor/ class="link black dim">使用general_log来对Mysql SQL语句监控查看的记录</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">查看日志位置：
show global variables like '%general%'; +——————+———-+ |Variable_name|Value| +——————+———-+ |general_log|OFF| |general_log_file|/data0/logs/mysql/general.log| +——————+———-+ 设置 SET GLOBAL general_log = 'ON';
使用tail -f 日志位置 查看即时日志。
临时开启日志记录
set global general_log='ON'; 这时执行的所有sql都会被记录下来，但是如果重启mysql就会停止记录需要重新设置
查看日志
tail -f /data0/logs/mysql/general.log 查看全部
cat /data0/logs/mysql/general.log 查看是否开启binlog
show variables like “log_bin” ; 查看当前的binlog日志
show master status ;</div><a href=/blog/mysql-sql-monitor/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-dump-usage/ class="link black dim">使用mysqldump导出mysql表结构和表数据</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">创建备份用户 create user dumper@'127.0.0.1' identified by '12345678'; 赋权限 grant select on *.* to dumper@'127.0.0.1'; grant lock tables on *.* to dumper@'127.0.0.1'; 备份脚本 #!/bin/bash mkdir /tmp/`date +%y%m%d` mysqldump -h127.0.0.1 -u dumper -p12345678 dbname > /tmp/`date +%y%m%d`/db.sql crontab定时任务 凌晨三点执行脚本。
0 3 * * * /opt/software/backup_db.sh >/dev/null 2>&amp;1 MySQL 备份包含 emoji 表情的数据 在执行备份命令时，指定字符集即可（@see mysqldump &ndash;help）
$ mysqldump -uroot -p123456 --default-character-set=utf8mb4 db_name > db_name_bak.sql 常见用法 命令行下具体用法如下：
mysqldump -u用戶名 -p密码 -d 数据库名 表名 > 脚本名; 导出整个数据库结构和数据</div><a href=/blog/mysql-dump-usage/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div><div class="relative w-100 mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height"><div class="bg-white mb3 pa4 gray overflow-hidden"><span class="f6 db">Blogs</span><h1 class="f3 near-black"><a href=/blog/mysql-view-database-table-capacity/ class="link black dim">MySQL查看数据库表容量大小</a></h1><div class="nested-links f5 lh-copy nested-copy-line-height">1.查看所有数据库容量大小 select table_schema as '数据库', sum(table_rows) as '记录数', sum(truncate(data_length / 1024 / 1024, 2)) as '数据容量(MB)', sum(truncate(index_length / 1024 / 1024, 2)) as '索引容量(MB)' from information_schema.tables group by table_schema order by sum(data_length) desc, sum(index_length) desc; 2.查看所有数据库各表容量大小 select table_schema as '数据库', table_name as '表名', table_rows as '记录数', truncate(data_length / 1024 / 1024, 2) as '数据容量(MB)', truncate(index_length / 1024 / 1024, 2) as '索引容量(MB)' from information_schema.tables order by data_length desc, index_length desc; 3.</div><a href=/blog/mysql-view-database-table-capacity/ class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a></div></div></div></section></div></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://linkall.pub/>&copy; 逆天改命 2024</a><div><div class=ananke-socials></div></div></div></footer></body></html>