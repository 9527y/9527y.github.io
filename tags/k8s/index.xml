<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>k8s on 逆天改命</title><link>https://linkall.pub/tags/k8s/</link><description>Recent content in k8s on 逆天改命</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 03 Jun 2021 08:29:14 +0000</lastBuildDate><atom:link href="https://linkall.pub/tags/k8s/index.xml" rel="self" type="application/rss+xml"/><item><title>kubernetes coredns无法解析私有harbor域名问题处理</title><link>https://linkall.pub/blog/k8s-coredns-looksup-local-harbor-domain/</link><pubDate>Thu, 03 Jun 2021 08:29:14 +0000</pubDate><guid>https://linkall.pub/blog/k8s-coredns-looksup-local-harbor-domain/</guid><description>修改coredns配置，增加host对应；
1,/etc/hosts 添加相关的域名解析 xx.xx.xx.xx harbor.alexdev.com 2，修改coredns configmap，添加hosts语段： # kubectl get cm coredns -n kube-system -o yaml apiVersion: v1 data: Corefile: | .:53 { errors health { lameduck 5s } ready kubernetes cluster.local in-addr.arpa ip6.arpa { pods insecure fallthrough in-addr.arpa ip6.arpa } ## 主要为以下内容(注意末尾添加 .cluster.local)： ## hosts内部可以添加多个域名 hosts { xx.xx.xx.xx harbor.alexdev.com.cluster.local fallthrough } prometheus :9153 forward . /etc/resolv.conf { prefer_udp } 3,添加后，如果pod内仍无法ping通域名，可以删除coredns pod，重新加载cm文件 # kubectl get pods -A|grep coredns kube-system coredns-6b55b6764d-7wdsq 1/1 Running 1 18h kube-system coredns-6b55b6764d-d4q72 1/1 Running 1 18h # kubectl delete pod coredns-6b55b6764d-7wdsq -n kube-system # kubectl delete pod coredns-6b55b6764d-d4q72 -n kube-system 4,测试 kubectl run -i --tty --image busybox:1.</description></item></channel></rss>